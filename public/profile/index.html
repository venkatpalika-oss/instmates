<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Technician Profile | InstMates</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/assets/css/style.css?v=2026-02-22" />
</head>

<body data-page="technician-profile">

<div id="siteHeader"></div>

<nav class="crumbs">
  <a href="/">Home</a><span>‚Ä∫</span>
  <a href="/profiles/">Profiles</a><span>‚Ä∫</span>
  <span class="current">Technician Profile</span>
</nav>

<main class="container">

<section id="profileContainer" class="panel">
  <p class="muted">Loading profile‚Ä¶</p>
</section>

</main>

<div id="siteFooter"></div>

<script src="/assets/js/includes.js?v=2026-02-22"></script>

<script type="module">

import { db } from "/assets/js/firebase.js";
import { doc, getDoc }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const container = document.getElementById("profileContainer");

const params = new URLSearchParams(window.location.search);
const uid = params.get("uid");

if (!uid) {
  container.innerHTML = "<p class='muted'>Profile not found.</p>";
} else {
  loadProfile(uid);
}

async function loadProfile(uid) {

  const snap = await getDoc(doc(db, "profiles", uid));

  if (!snap.exists()) {
    container.innerHTML = "<p class='muted'>Profile not found.</p>";
    return;
  }

  const p = snap.data();

  const basic = p.basicInfo || {};
  const professional = p.professional || {};
  const achievement = p.achievement || {};
  const status = p.profileStatus || {};

  if (status.isPublic === false) {
    container.innerHTML = "<p class='muted'>This profile is private.</p>";
    return;
  }

  /* ================= SIGNATURE CASE ================= */

  let signatureCaseHTML = "";

  if (p.isVerified && p.signatureCaseId) {

    const caseSnap = await getDoc(
      doc(db, "signatureCases", p.signatureCaseId)
    );

    if (caseSnap.exists()) {

      const c = caseSnap.data();

      signatureCaseHTML = `
        <hr style="margin:30px 0">

        <h3>üèÖ Signature Case</h3>

        <div style="background:#f8f9fa;padding:16px;border-radius:10px">

          <h4>${c.title}</h4>

          <p><strong>Problem:</strong><br>
          ${c.problem || ""}</p>

          <p><strong>Corrective Action:</strong><br>
          ${c.actionTaken || ""}</p>

          <p><strong>Result:</strong><br>
          ${c.result || ""}</p>

        </div>
      `;
    }
  }

  /* ================= SKILLS ================= */

  const skillsHTML = Array.isArray(professional.analyzersWorked) &&
                   professional.analyzersWorked.length
  ? `
     <h3>Analyzers Worked</h3>
     <div class="tag-container">
       ${professional.analyzersWorked.map(a =>
         `<span class="tech-tag">${a}</span>`
       ).join("")}
     </div>
    `
  : "";

  /* ================= ACHIEVEMENT ================= */

  const achievementHTML = achievement.title
    ? `
       <hr style="margin:20px 0">
       <h3>Major Troubleshooting Case</h3>
       <div style="background:#f8f9fa;padding:16px;border-radius:10px">
         <h4>${achievement.title}</h4>
         <p><strong>Description:</strong><br>${achievement.description || ""}</p>
         <p><strong>Impact:</strong><br>${achievement.impact || ""}</p>
       </div>
      `
    : "";

  container.innerHTML = `
    <div style="text-align:center">

      <img src="${basic.profilePhoto || "/assets/img/default-avatar.png"}"
           style="width:120px;height:120px;border-radius:50%;object-fit:cover">

      <h2>
        ${basic.fullName || "Technician"}
        ${
          p.isVerified
            ? `<span style="color:#0d6efd;font-size:16px;margin-left:8px">‚úî Verified</span>`
            : ""
        }
      </h2>

      <p class="muted">${basic.headline || ""}</p>
      <p class="muted">üìç ${basic.location || ""}</p>
      <p class="muted">${basic.experienceYears || 0} Years Experience</p>

    </div>

    <hr style="margin:20px 0">

    <h3>Specialization</h3>
    <p>${professional.specialization || "Not specified"}</p>

    <hr style="margin:20px 0">

    <h3>Plant Type</h3>
    <p>${professional.plantType || "Not specified"}</p>

    ${skillsHTML}

    ${achievementHTML}

    ${signatureCaseHTML}
  `;
}

</script>

</body>
</html>